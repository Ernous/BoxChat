{% extends "base.html" %}
{% block content %}
<div class="main" style="padding: 40px; align-items: center;">
    <form method="POST" enctype="multipart/form-data" style="background: #2f3136; padding: 30px; border-radius: 10px; width: 500px;">
        <h2>Настройки комнаты</h2>
        
        <label>Название:</label>
        <input type="text" name="name" value="{{ room.name }}" class="input-box" style="margin-bottom: 15px;" required>
        
        <div style="margin-bottom: 20px; text-align: center;">
            <img src="{{ room.avatar_url or 'https://via.placeholder.com/100' }}" id="avatarPreview" style="width: 100px; height: 100px; border-radius: 50%; object-fit: cover; margin-bottom: 10px; cursor: pointer;" onclick="document.getElementById('avatar_file').click();">
            <br>
            <input type="file" name="avatar_file" id="avatar_file" accept="image/*" style="display: none;" onchange="previewAvatar(this);">
            <button type="button" class="btn" onclick="document.getElementById('avatar_file').click();" style="font-size: 0.9em;">Загрузить аватар</button>
            {% if room.avatar_url %}
            <button type="button" class="btn btn-red" onclick="deleteRoomAvatar({{ room.id }});" style="font-size: 0.9em; margin-left: 10px;">Удалить аватар</button>
            {% endif %}
        </div>
        
        <div style="display: flex; gap: 10px;">
            <button type="submit" class="btn">Сохранить</button>
            <a href="{{ url_for('view_room', room_id=room.id) }}" class="btn btn-red">Отмена</a>
        </div>
    </form>
</div>

<script>
function previewAvatar(input) {
    if (input.files && input.files[0]) {
        const reader = new FileReader();
        reader.onload = function(e) {
            document.getElementById('avatarPreview').src = e.target.result;
        };
        reader.readAsDataURL(input.files[0]);
    }
}

function deleteRoomAvatar(roomId) {
    if (!confirm('Удалить аватар сервера?')) return;
    
    fetch(`/room/${roomId}/avatar/delete`, { method: 'POST' })
    .then(r => r.json())
    .then(data => {
        if (data.success) {
            location.reload();
        } else {
            alert('Ошибка: ' + (data.error || 'Неизвестная ошибка'));
        }
    });
}
</script>
{% endblock %}

